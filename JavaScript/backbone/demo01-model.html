<!DOCTYPE html>
<html>

<head>
    <title>the5fire-backbone-model</title>
    <meta charset="utf-8">
</head>

<body>
</body>
<script src="http://the5fireblog.b0.upaiyun.com/staticfile/jquery-1.10.2.js"></script>
<script src="http://the5fireblog.b0.upaiyun.com/staticfile/underscore.js"></script>
<script src="http://the5fireblog.b0.upaiyun.com/staticfile/backbone.js"></script>
<script>
(function($) {
    var Man = Backbone.Model.extend({
        url: '/test.json',
        // 对象属性赋值
        defaults: {
            name: '张三',
            age: '38'
        },
        // 构造函数，创建对象时触发
        initialize: function() {
            // 绑定对象 set 时触发的 change 事件，冒号后可加字段名
            this.bind("change:name", function() {
                var name = this.get("name");
                console.log("你改变了name属性为：" + name);
            });

            // 绑定对象 save 时的 validate 事件
            this.bind("invalid", function(model, error) {
                console.log(error);
            });

            // 绑定 ajax 请求 error 事件
            this.bind("error", function(model, error) {
                console.log(error);
            });
        },
        // 添加验证规则
        validate: function(attributes) {
            if (attributes.name == '') {
                return "name不能为空！";
            }
        },
        // 对象方法
        aboutMe: function() {
            return '我叫' + this.get('name') + ',今年' + this.get('age') + '岁';
        }
    });

    var man = new Man;

    // 设置对象属性
    man.set({
        name: '刘德华',
        age: 10
    });
    // alert(man.get('name')); // 访问对象属性
    // alert(man.aboutMe()); // 访问对象方法

    // 监听 validate 事件
    man.on('invalid', function(model, error) {
        console.log(error);
    });

    //  set 时的触发事件改为 validate 
    man.set({
        name: '李四'
    }, {
        'validate': true
    });

    // 触发 validate 事件，验证通过发送 ajax 请求
    man.save();

    man.fetch(); // ajax 获取数据，通过对象的 url 地址获取

    man.fetch({
        url: '/test.json',
        success: function(model, response) {
            console.log('success');
            console.log(model);
        }
    });
})(jQuery);
</script>

</html>
